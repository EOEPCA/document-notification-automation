# Producing Events

Producers are components responsible for generating and emitting events. The events are further captured by `Sinks` (usually Brokers or Channels) and further routed by the notification system. 

As presented in the architecture section event producers can be any application running inside Kubernetes as long as it can `HTTP POST` events to a resolved `Sink`.

The recommended approach in EOEPCA+ is the usage of `SinkBindings` for connecting existing applications to the notification system. This method allows extended flexibility without requiring significant changes to the code base.

In order for applications to be compatible with the `SinkBinding` approach they must follow the following conventions:

Applications should check if two specific environment variables are set:

- `K_SINK` representing the URL of the resolved destination sink - `K_CE_OVERRIDES` containing a JSON object that specifies overrides to the outbound event.

If the `K_SINK` environment variable is present then they can produce events otherwise they can supress them.

Applications compliant with the above conventions can be direct externally to post to a specific `sink` using either the `kn` command line tool or declaratively using the KNative-Eventing CRDs.

For example the following `SinkBinding` directs messages generated by `resource-catalogue-service` to the broker named `primary` in the `default` namespace.

```yaml
apiVersion: sources.knative.dev/v1
kind: SinkBinding
metadata:
  name: bind-resource-catalogue-service
spec:
  subject:
    apiVersion: apps/v1
    kind: Deployment
    namespace: resource-registration
    name: resource-catalogue-service
  sink:
    ref:
      apiVersion: eventing.knative.dev/v1
      kind: Broker
      name: primary
      namespace: default
```

## Python Examples

An example code snippet for applications adhering to the `SinkBinding` conventions:

```python
import os
import requests
from cloudevents.http import CloudEvent
from cloudevents.conversion import to_binary, to_structured

k_sink = os.environ.get("K_SINK", None)
k_ce_overrides_str = os.environ.get("K_CE_OVERRIDES", None)


if k_sink is not None:
    data = {
        # Something specific to the Building Block
    }
    attributes = {
        "type": "org.eoepca.resource-registration.resource.added",
        "source": "http://resource-registration.apx.develop.eoepca.org/catalogue" 
    }
    event = CloudEvent(attributes, data)
    headers, body = to_binary(event)
    requests.post(k_sink, data=body, headers=headers)
```

Other applications can directly post to the broker endpoint, for example:

http://broker-ingress.knative-eventing.svc.cluster.local/default/primary

